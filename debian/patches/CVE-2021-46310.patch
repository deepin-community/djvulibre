Description: CVE-2021-46310: Divide by zero in IW44Image::Map::image()
Bug-Debian: https://bugs.debian.org/1052668
Origin: upstream
Bug: https://sourceforge.net/p/djvu/bugs/345/

--- djvulibre-3.5.28.orig/libdjvu/IW44Image.cpp
+++ djvulibre-3.5.28/libdjvu/IW44Image.cpp
@@ -676,10 +676,10 @@ IW44Image::Map::image(signed char *img8,
   // Allocate reconstruction buffer
   short *data16;
   size_t sz = bw * bh;
-  if (sz / (size_t)bw != (size_t)bh) // multiplication overflow
-    G_THROW("IW44Image: image size exceeds maximum (corrupted file?)");
   if (sz == 0)
     G_THROW("IW44Image: zero size image (corrupted file?)");
+  if (sz / (size_t)bw != (size_t)bh) // multiplication overflow
+    G_THROW("IW44Image: image size exceeds maximum (corrupted file?)");
   GPBuffer<short> gdata16(data16,sz);
   if (data16 == NULL)
     G_THROW("IW44Image: unable to allocate image data");
